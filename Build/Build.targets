<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <ArtifactDir>$(BinDir)\$(BuildConfig)</ArtifactDir>
    <PlatformProperties>$(BuildSysDir)\$(ReferencedPlatform).props</PlatformProperties>
    <BuildProperties>
      Configuration=$(BuildConfig);
      ReferencedPlatform=$(ReferencedPlatform);
      BuildFlavour=$(BuildFlavour)
    </BuildProperties>
  </PropertyGroup>
  
  <Target Name="Build">
    <MSBuild Projects="$(Solution)" Targets="Build" Properties="$(BuildProperties)" />
  </Target>
  
  <Target Name="Rebuild">
    <MSBuild Projects="$(Solution)" Targets="Rebuild" Properties="$(BuildProperties)" />
  </Target>
  
  <Target Name="Clean">
    <MSBuild Projects="$(Solution)" Targets="Clean" Properties="$(BuildProperties)" />
  </Target>

  <ItemGroup>
    <SourceDLLs Include="@(Libs->'$(ArtifactDir)\%(Identity).dll')" />
    <SourceXMLs Include="@(Libs->'$(ArtifactDir)\%(Identity).xml')" />
    <StageFolder Include="$(StageDir)\lib\$(ReferencedPlatform)" />
  </ItemGroup>
  
  <Target Name="PlatformStage" DependsOnTargets="Build"
          Inputs="@(SourceDLLs);@(SourceXMLs)"
          Outputs="@(SourceDLLs->'$(StageFolder)\%(Filename).%(Extension)')">
    <Copy 
      SourceFiles="@(Libs->'$(ArtifactDir)\%(Identity).dll')"
      DestinationFolder="$(StageFolder)" />
    <Copy
      SourceFiles="@(Libs->'$(ArtifactDir)\%(Identity).xml')"
      DestinationFolder="$(StageFolder)" />
  </Target>
</Project>
